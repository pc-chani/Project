<div class="content">
    <table *ngFor="let p of products" class="table table-hover">
        <tbody>
            <tr >
                <td (click)="showdetails(p)">{{p.Name}} </td>
                <td *ngIf="p.IsDisposable"><input type="number" value="{{p.Amount}}" min="0" #num
                        (change)="changeAmount(p,num.value)"></td>
                <td *ngIf="!p.IsDisposable">
                    <mat-form-field appearance="fill">
                        <mat-label>Enter a date range</mat-label>
                        <mat-date-range-input [rangePicker]="picker" [dateFilter]="rangeFilter" [max]="max"  >
                            <!---->
                            <input matStartDate placeholder="Start date" (dateChange)="setStartDate($event.value)">
                            <input matEndDate placeholder="End date" (dateChange)="setEndDate($event.value)">
                        </mat-date-range-input>
                        <mat-datepicker-toggle matSuffix [for]="picker" ></mat-datepicker-toggle>
                        <mat-date-range-picker (opened)="myP(p)" #picker [dateClass]="dateClass"></mat-date-range-picker>
                        
                    </mat-form-field>
                    <textarea matInput  *ngIf="comment && p==CurrentProduct"
                    cdkTextareaAutosize
                    #autosize="cdkTextareaAutosize"
                    cdkAutosizeMinRows="1"
                    cdkAutosizeMaxRows="5" [formControl]="comments"
                    class="comment"></textarea>
                <td> <button  mat-raised-button color="primary" (click)="saveChange(p)">שמור שינויים</button></td>
                <td>

                    <button mat-mini-fab color="primary">
                        <mat-icon (click)="showdetails(p)">create</mat-icon>
                    </button>
                </td>
                <td>
                    <button mat-mini-fab color="primary">
                        <mat-icon (click)="deleteProduct(p)">delete</mat-icon>
                    </button>
                </td>

            </tr>
            <tr *ngIf="show && p==CurrentProduct"  >
                <div>
                    <form [formGroup]="editPForm">
                        <mat-icon (click)="close()">clear</mat-icon>
                        <input type="text" placeholder="בחר " aria-label="Number" matInput formControlName="Name"
                            [matAutocomplete]="auto" [value]="displayFn">
                        <mat-autocomplete matAutocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                            <mat-option *ngFor="let p of filteredPs | async" [value]="p">
                                {{p.Productname}}
                            </mat-option>
                        </mat-autocomplete>
                        <div class="error" *ngIf="newPForm.controls['Name'].errors!=null">*</div>
                        <p>תמונה</p>
                        <p> <input type="file" (change)="handleFileInput($event.target.files)" multiple
                                accept="image/png, image/jpeg, image/jpg, application/msword, application/vnd.ms-excel, application/pdf " />
                            <!----> <img *ngFor="let url of CurrentProduct.Images" [src]="url" class="rounded mb-3"
                                width="180" mat-card-image>
                            <img *ngFor="let url of urls" [src]="url" class="rounded mb-3" width="180" mat-card-image>
                        </p>
                        <p>חד פעמי?<input type="checkbox" [checked]="CurrentProduct.FreeDescription"
                                formControlName="IsDisposable"></p>
                        <p>הערות<input type="text" value="{{CurrentProduct.FreeDescription}}"
                                formControlName="FreeDescription"></p>
                        <p>פקדון<input type="number" value="{{CurrentProduct.SecurityDepositAmount}}"
                                formControlName="SecurityDepositAmount"></p>
                        <p>מצב<input type="text" value="{{CurrentProduct.Status}}" formControlName="Status"></p>
                        <p><input type="button" class="btn btn-primary" (click)="setP()" value="שמור שינויים"></p>
                    </form>
                </div>
            </tr>
        </tbody>
    </table>
    <div class="img">
    <button mat-mini-fab color="primary">
    <mat-icon (click)="add()">add_circle</mat-icon>
    </button>
    <span class="text">הוסף מוצר</span>
</div>
    <form [formGroup]="newPForm" *ngIf="newProduct">
        <div class="form-group">
            <mat-icon (click)="closeNew()">clear</mat-icon>
            <label> שם:</label>
            <input type="text" placeholder="בחר " aria-label="Number" matInput formControlName="Name"
                [matAutocomplete]="auto" [value]="displayFn">
            <mat-autocomplete matAutocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                <mat-option *ngFor="let p of filteredPs | async" [value]="p">
                    {{p.Productname}}
                </mat-option>
            </mat-autocomplete>
            <div class="error" *ngIf="newPForm.controls['Name'].errors!=null">*</div>
        </div>
        <div class="form-group">
            <label> :תאור </label>
            <input class="txt" type="text" class="form-control" formControlName="FreeDescription">
            <div class="error" *ngIf="newPForm.controls['FreeDescription'].errors!=null"> שדה נדרש </div>
        </div>
        <div class="form-group">
            <label> :תמונה </label>
            <div class="input-box">
                <input type="file" (change)="handleFileInput($event.target.files)" multiple
                    accept="image/png, image/jpeg, image/jpg, application/msword, application/vnd.ms-excel, application/pdf " />
            </div>

            <img *ngFor="let url of urls" [src]="url" class="rounded mb-3" width="180" mat-card-image>
        </div>
        <div class="form-group">
            <label> :כמות </label>
            <input class="txt" type="number" class="form-control" formControlName="Amount">
            <div class="error" *ngIf="newPForm.controls['Amount'].errors!=null"> שדה נדרש </div>
        </div>

        <div class="form-group">
           
             <mat-checkbox  class="txt" type="checkbox" formControlName="IsDisposable">
               האם חד פעמי?</mat-checkbox>
            <div class="error" *ngIf="newPForm.controls['IsDisposable'].errors!=null"> שדה נדרש </div>
        </div>
        <div class="form-group">
            <label> : פקדון </label>
            <input class="txt" type="number" class="form-control" formControlName="SecurityDepositAmount">
            <div class="error" *ngIf="newPForm.controls['SecurityDepositAmount'].errors!=null"> שדה נדרש </div>
        </div>
        <div class="form-group">
            <label> : סטטוס </label>
            <input class="txt" type="text" class="form-control" formControlName="Status">
            <div class="error" *ngIf="newPForm.controls['Status'].errors!=null"> שדה נדרש </div>
        </div>
        <div>
            <input type="button" class="btn btn-success" value="הוסף" (click)="setProduct()"
                [disabled]="!newPForm.valid" style="margin-right: 35%;">
        </div>
    </form>
    <button  mat-raised-button color="primary" [routerLink]="['/manageTheGMH']" routerLinkActive="active">חזרה לגמחים</button>
</div>